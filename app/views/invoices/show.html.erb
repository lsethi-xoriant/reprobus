<% provide(:title, "Invoice for " +  @booking.name ) %>
<div class="row">
  <aside class="col-lg-12">
    <section>
      <h1 class="page-header" ><%= "Invoice for " +  @booking.name%></h1>
       <a href=<%= booking_path @booking%>><button type="button" class="btn btn-primary">Back to Booking</button></a> <br><br>
      <strong>Booking start date</strong>	<%= @booking.enquiry.est_date.strftime("%d/%m/%Y")  %><br>
      <strong>Invoice date</strong>	<%= @invoice.invoice_date.strftime("%d/%m/%Y")  %><br>
      <strong>Deposit due</strong>	<%= @invoice.deposit_due.strftime("%d/%m/%Y")  %><br>
      <strong>Final payment due</strong>	<%= @invoice.final_payment_due.strftime("%d/%m/%Y")  %><br>
      <strong>Customer/s:</strong>		<%= @booking.customer.fullname %><br>
      <strong>Currency</strong>	<%= @invoice.getCurrencyDisplay %><br>
      
      <div>
        <br>

        <table width="100%">
          <tr>
            <th width="40%" align="left">Description</th><th width="20%" align="left">Quantity</th><th width="20%" align="left">Price</th><th width="20%" align="left">Total</th>
          </tr> 

          <% @invoice.line_items.each do |item| %>
          <%= render partial: 'invoices/line_items', locals: { item: item } %>
          <% end %> 
        </table>
      </div>
      <br>
      Total <strong><%=  number_to_currency(@invoice.getTotalAmount, precision: 2) %> </strong><br>
      <br>
      Exch Rate when created <strong><%= number_to_currency(@invoice.exchange_amount.to_s, precision: 2)  + " " +  Setting.find(1).currencyCode %> </strong><br>
      Current Exch Rate <strong><%= number_to_currency(@invoice.get_current_exchange_amount, precision: 2) + " " +  Setting.find(1).currencyCode %> </strong><br>
      <br>
      Deposit	<strong><%= number_to_currency(@invoice.deposit, precision: 2) %></strong><br>
      Amount paid throuh payment gateway <strong><%= number_to_currency(@invoice.getCCPaidTotal, precision: 2) %></strong><br>
      Balance <strong>TO DO</strong><br>
     
      <br>
      </section>
  </aside> 
</div>

<div>
  <a href=<%= booking_invoice_path @booking, @invoice, format: :pdf %>  target="_blank" ><button type="button" class="btn btn-primary">View Pdf</button></a>
  <br><br>
  <% if Setting.find(1).use_xero  %>
    <% if @invoice.xero_id.blank? %>

    <% else %>
    <%=  form_tag({controller: "invoices", action: "getxeroinvoice", remote: true}, method: "get", class: "form-horizontal", remote: true) do %>
      <%= hidden_field_tag :id, '', :value => @invoice.id %>
      <%= submit_tag "Get Xero Invoice Details", id: "invoiceBtn", class: "btn btn-primary" %>     
      <% end %>
    <% end %>
  <% end %>
  <br>
  <div id="invoices" >
     <%= render partial: 'invoice', locals: {items: @xinvoice}  %>
  </div>
</div> 